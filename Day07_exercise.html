<script>
    class Produk {
        constructor(_name, _stock, _price) {
            this.name = _name;
            this.stock = _stock;
            this.price = _price;
        }

        getInfo = () => {
            return `${this.name}, Stok = ${this.stock}, Rp. ${this.price.toLocaleString('id')}`;
        }
    }

    class FnB extends Produk {
        constructor(_name, _stock, _price, _type, _expDate) {
            super(_name, _stock, _price);
            this.type = _type;
            this.expDate = _expDate;
        }

        getInfo = () => {
            return `${this.name}, Stok = ${this.stock}, Rp. ${this.price.toLocaleString('id')}, Expired : ${this.expDate}`;
        }
    }


    let dbProduct = [
        new Produk('Baju', 12, 35000),
        new Produk('Celana', 10, 70000),
        new FnB('Telur', 10, 1500, "Makanan", "20-06-2022")
    ]

    const printData = (data = dbProduct) => {
        let list = data.map((val, idx) => {
            return `${idx + 1}. ${val.getInfo()}`;
        })
        return list.join('\n');
    }

    while (true) {
        let mainMenu = prompt(`Selamat datang di Toko Kelontong :
        1. Tambah Produk
        2. Beli Produk
        3. Cek Stok`)

        if (mainMenu == 1) {
            let category = prompt('Pilih kategori produk :\n1. General\n2. FnB')
            let name = prompt('Masukkan nama produk :');
            let stock = parseInt(prompt('Masukkan stok produk :'));
            let price = parseInt(prompt('Masukkan harga produk :'));
            if (category == 1) {
                dbProduct.push(new Produk(name, stock, price));
            } else if (category == 2) {
                let type = prompt("Type produk :")
                let expDate = prompt("Expired date produk :")
                dbProduct.push(new FnB(name, stock, price, type, expDate));
            }

            alert(`Produk baru sudah terdaftar ‚úÖ`);
        } else if (mainMenu == 2) {
            // Pilih barang yg dibeli
            let beli = parseInt(prompt(`Silahkan pilih produk :\n${printData()}`)) - 1;
            while (true) {
                let qty = parseInt(prompt(`Beli ${dbProduct[beli].name} berapa ?`));

                if (qty <= dbProduct[beli].stock) {
                    let totalBeli = qty * dbProduct[beli].price;
                    let pembayaran = parseInt(prompt(`Total belanja Rp. ${totalBeli.toLocaleString('id')}
        Masukkan uang anda :`));
                    let kembalian = pembayaran - totalBeli;

                    if (kembalian < 0) {
                        alert('Uang tidak cukup, pembelian gagal ‚ùå');
                        break;
                    } else {
                        alert(`Pembelian berhasil ‚úÖ
            Kembalian anda adalah Rp. ${kembalian.toLocaleString('id')}`);

                        // Pengurangan stock
                        dbProduct[beli].stock -= qty;
                        // Jika barang habis, maka langsung kita hapus
                        if (dbProduct[beli].stock == 0) {
                            dbProduct.splice(beli, 1)
                        }
                        break;
                    }
                }
                else {
                    let transaksi = confirm('Stock tidak cukup, mau input ulang ?')
                    if (!transaksi) {
                        break;
                    }
                }

            }
            // Input qty yg dibeli

        } else if (mainMenu == 3) {
            // Menentukan user mau lihat stok barang yg Non-FnB atau yang FnB
            // 1. Menentukan pilihan data yang ingin ditampilkan ==> prompt => conditional statement
            let filterData = prompt('Pilih jenis produk :\n1. Non FnB\n2. FnB\n0. Semua');
            let general = [], fnb = [];
            // 2. Melakukan filter data sesuai dengan pilihan data ==> looping ==> array baru
            // mengakses data dari dbProduct satu per satu
            dbProduct.forEach((val, idx) => {
                // apakah memiliki property expDate
                // Jika tidak punya, maka kita masukkan ke array baru
                if (!val.expDate) {
                    general.push(val)
                } else {
                    fnb.push(val)
                }
            })
            if (filterData == 1) {
                alert(`Produk tersedia :\n${printData(general)}`);
            } else if (filterData == 2) {
                // 3. Menampilkan data hasil filter ==> looping
                alert(`Produk tersedia :\n${printData(fnb)}`);
            } else if (filterData == 0) {
                alert(`Produk tersedia :\n${printData()}`);
            } else {
                alert('Jenis produk tidak dikenali ‚ö†Ô∏è')
            }
        } else {
            alert('Pilihan anda tidak sesuai ‚ùå')
        }

        let logOut = confirm(`Ke menu utama ?`)
        if (logOut == false) {
            alert(`Terima kasih sudah berkunjung üòÅ`);
            break;
        }

    }
</script>