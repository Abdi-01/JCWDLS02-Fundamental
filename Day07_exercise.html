<script>
    class Produk {
        constructor(_name, _stock, _price) {
            this.name = _name;
            this.stock = _stock;
            this.price = _price;
        }

        getInfo = () => {
            return `${this.name}, Stok = ${this.stock}, Rp. ${this.price.toLocaleString('id')}`;
        }
    }

    class FnB extends Produk {
        constructor(_name, _stock, _price, _type, _expDate) {
            super(_name, _stock, _price);
            this.type = _type;
            this.expDate = _expDate;
        }

        getInfo = () => {
            return `${this.name}, Stok = ${this.stock}, Rp. ${this.price.toLocaleString('id')}, Expired : ${this.expDate}`;
        }
    }


    let dbProduct = [
        new Produk('Baju', 12, 35000),
        new Produk('Celana', 10, 70000)
    ]

    const printData = () => {
        let list = dbProduct.map((val, idx) => {
            return `${idx + 1}. ${val.getInfo()}`;
        })
        return list.join('\n');
    }

    while (true) {
        let mainMenu = prompt(`Selamat datang di Toko Kelontong :
        1. Tambah Produk
        2. Beli Produk
        3. Cek Stok`)

        if (mainMenu == 1) {
            let category = prompt('Pilih kategori produk :\n1. General\n2. FnB')
            let name = prompt('Masukkan nama produk :');
            let stock = parseInt(prompt('Masukkan stok produk :'));
            let price = parseInt(prompt('Masukkan harga produk :'));
            if (category == 1) {
                dbProduct.push(new Produk(name, stock, price));
            } else if (category == 2) {
                let type = prompt("Type produk :")
                let expDate = prompt("Expired date produk :")
                dbProduct.push(new FnB(name, stock, price, type, expDate));
            }

            alert(`Produk baru sudah terdaftar ✅\n${printData()}`);
        } else if (mainMenu == 2) {
            // Pilih barang yg dibeli
            let beli = parseInt(prompt(`Silahkan pilih produk :\n${printData()}`)) - 1;
            while (true) {
                let qty = parseInt(prompt(`Beli ${dbProduct[beli].name} berapa ?`));

                if (qty <= dbProduct[beli].stock) {
                    let totalBeli = qty * dbProduct[beli].price;
                    let pembayaran = parseInt(prompt(`Total belanja Rp. ${totalBeli.toLocaleString('id')}
        Masukkan uang anda :`));
                    let kembalian = pembayaran - totalBeli;

                    if (kembalian < 0) {
                        alert('Uang tidak cukup, pembelian gagal ❌');
                        break;
                    } else {
                        alert(`Pembelian berhasil ✅
            Kembalian anda adalah Rp. ${kembalian.toLocaleString('id')}`);

                        // Pengurangan stock
                        dbProduct[beli].stock -= qty;
                        // Jika barang habis, maka langsung kita hapus
                        if (dbProduct[beli].stock == 0) {
                            dbProduct.splice(beli, 1)
                        }
                        break;
                    }
                }
                else {
                    let transaksi = confirm('Stock tidak cukup, mau input ulang ?')
                    if (!transaksi) {
                        break;
                    }
                }

            }
            // Input qty yg dibeli

        } else if (mainMenu == 3) {
            alert(`Produk tersedia :\n${printData()}`);
        } else {
            alert('Pilihan anda tidak sesuai ❌')
        }

        let logOut = confirm(`Ke menu utama ?`)
        if (logOut == false) {
            alert(`Terima kasih sudah berkunjung 😁`);
            break;
        }

    }
</script>